#!/bin/sh

echo "ğŸ” Running pre-commit hook to check the code looks good... ğŸ”"

# Load NVM if available (useful for managing Node.js versions)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Ensure `pnpm` is available
echo "Checking if pnpm is available..."
if ! command -v pnpm >/dev/null 2>&1; then
    echo "âŒ pnpm not found! Please ensure pnpm is installed and available in PATH."
    exit 1
fi

# Run typecheck
echo "Running typecheck..."
# If node is not available, skip pnpm checks (useful for environments where node isn't installed)
if ! command -v node >/dev/null 2>&1; then
    echo "âš ï¸  'node' not found in PATH â€” skipping typecheck and lint. Install Node.js to enable these checks locally."
else
    if ! pnpm typecheck; then
        echo "âŒ Type checking failed! Please review TypeScript types."
        echo "Once you're done, don't forget to add your changes to the commit! ğŸš€"
        exit 1
    fi

    # Run lint
    echo "Running lint..."
    if ! pnpm lint; then
        echo "âŒ Linting failed! Run 'pnpm lint:fix' to fix the easy issues."
        echo "Once you're done, don't forget to add your beautification to the commit! ğŸ¤©"
        exit 1
    fi
fi

echo "ğŸ‘ All checks passed (or were skipped). Committing changes..."
